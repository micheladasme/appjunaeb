<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="css/jquery.mobile.flatui.css" />
  <script src="js/jquery.js"></script>
  <script src="js/jquery.mobile-1.4.2.min.js"></script>
  <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script src="ui/jquery.ui.map.js"></script>
  <script src="ui/jquery.ui.map.overlays.js"></script>
  <script src="ui/jquery.ui.map.extensions.js"></script>
  <style>

  #mapa{
  width: 100%;
  height: 400px;
  border: 1px solid black;
}
  </style>

    <script>
    function buscarme(){
      if (!navigator.geolocation){
          alert("Error de gps");
          return;
        }

      function success(position) {
        var lat  = position.coords.latitude;
          var lng = position.coords.longitude;
          var coor = lat+","+lng;

          dibujarMapa(coor);
      };

      function error() {
         alert("No se puede encontrar su ubicación");
      };

      navigator.geolocation.getCurrentPosition(success, error);
    }

    function dibujarMapa(pos){

       $('#mapa').gmap({'center': pos, 'zoom': 15, 'disableDefaultUI':true, 'callback': function() {
          
          //instancia mapa
          var self = this;

          //agrego marcador rojo
          self.addMarker({'position': this.get('map').getCenter() }); 
          
          //agregar circulo que rodea el marcador
          self.addShape('Circle', { 
            'strokeWeight': 1, //cortorno del circulo
            'fillColor': "#FA5882", //color de shape
            'fillOpacity': 0.25, //opacidad de shape
            'center': this.get('map').getCenter(), //posicion de shape
            'radius': 500, //radio de shape
            'clickable': false 
          }); //FIN ADDSHAPE
          

      }}); //FIN GMAP
    } 

   $(document).ready(function() {
      $('#buscarme').click(buscarme);
      //Simulación de JSON
      var marcadores = [
        {
          "latitude":-33.515612,
          "longitude":-70.718592,
          "content":"San camilo",
        }, 
        {
          "latitude":-33.516959, 
          "longitude":-70.717183,
          "content":"Patio de Comidas Mall Plaza Oeste",
        },
        {
          "latitude":-33.515233, 
          "longitude":-70.718468,
          "content":"Casino Duoc UC",
        },
        {
          "latitude":-33.517960, 
          "longitude":-70.714883,
          "content":"Doggis tottus",
        }
      ];
      


      //Inicialización de mapa
      $('#mapa').gmap({ 'center': '-33.510436, -70.722169','zoom':15,'disableDefaultUI':false}).bind('init', function() { 
        
          //Inicio each
          $.each(marcadores, function(cont, marcadores) {
            
            $('#mapa').gmap('addMarker', {
              'position': new google.maps.LatLng(marcadores.latitude, marcadores.longitude), 
              'bounds': false 
            })
            .click(function() { 

              $('#mapa').gmap('openInfoWindow', { 
                'content': marcadores.content
              }, this);

            });
            //Fin click

          }); 
          //Fin each
      
      });

    
    });
  </script>

</head>
<body>
  <div data-role="page">

    <div data-role="panel" id="panel" data-position="right" data-theme="a" data-display="push"></div>

    <div data-role="header">
      <a data-iconpos="notext" data-role="button" data-icon="home" title="Home">Home</a>
      <h1>App Junaeb</h1>
      <a href="index.html" data-role="button" data-icon="flat-cross">Salir</a>
    </div>
   
    <div data-role="content" role="main">
       <div data-role="collapsible-set" data-theme="a" data-content-theme="a">
        <div data-role="collapsible" data-collapsed-icon="flat-bubble" data-expanded-icon="flat-cross" data-collapsed="false">
          <h3>Consulta de Saldo</h3>
          <p><p>Tu Saldo es de : <input type="text" id="dinero" value="<?php echo $f['Saldo']?>" readonly/></p>
       </p>
        </div>
        <div data-role="collapsible" data-collapsed-icon="flat-location" data-expanded-icon="flat-cross">
          <h3>Comercios Cercanos</h3>
          
           <div id="mapa">
           

           </div>  
          <input type="button" id="buscarme" value="Donde Estoy?">

         
        </div>
        
      </div>
    </div>
       </div>
</body>
</html>
